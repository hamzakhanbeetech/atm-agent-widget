webpackJsonp([3],{"+KvB":function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n("3j3K"),a=n("p3n4"),o=(n("XZJt"),n("NVOs")),s=function(){function e(e){this.fuguWidgetService=e,this.alive=!0,this.userDetails=new Object,this.configData=new Object,this.hostname="",this.defaultMessageToPublish="",this.iPadState=!0,this.newConversationInitiated=new i.p,this.customerChatClicked=new i.p,this.openAgentConversations=new i.p,this.customerConversations=[],this.showBackButton=!0,this.isCustomerChat=!1,this.totalUnreadCount=0,this.customerwiseUnreadCount={},this.channelwiseUnreadCount={},this.customeConversationsChanged=new i.p,this.newPostMessageReceived=new i.p,this.redirectionTooltipText="Hippo Chat"}return e.prototype.ngOnInit=function(){},e.prototype.postMessageToParentWindow=function(e){e.message_sender="NonCircularAgentIframe",window.parent.postMessage(e,this.parentOrigin)},e.prototype.putUserData=function(){var e,t=this.getUserBrowserDetails(),n={},i="",a="",o="";if(this.f_uid_Id)o=this.f_uid_Id;else{var s=this.makeid();s+=this.fuguWidgetService.fuguWidgetData.appSecretKey||"",this.f_uid_Id=s,o=s}if(e=this.getCookie("f_uid"),this.fuguWidgetService.fuguWidgetData.address&&Object.keys(this.fuguWidgetService.fuguWidgetData.address).length&&(n.address={},n.address.name="",this.fuguWidgetService.fuguWidgetData.address.city&&(n.address.name+=this.fuguWidgetService.fuguWidgetData.address.city),this.fuguWidgetService.fuguWidgetData.address.country&&(n.address.name+=" "+this.fuguWidgetService.fuguWidgetData.address.country)),this.ip&&(n.ip=this.ip),-1!==this.currentUrl.indexOf("utm_source")){var r=(c=(u=this.currentUrl).indexOf("utm_source"))+u.substring(c).indexOf("&");i=u.substring(c+11,r)}if(-1!==this.currentUrl.indexOf("utm_medium")){var u,c;r=(c=(u=this.currentUrl).indexOf("utm_medium"))+u.substring(c).indexOf("&");a=u.substring(c+11,r)}var d={device_id:o,device_type:3,device_details:t,source:4,browser_language:navigator.language,current_url:this.currentUrl};if(this.fuguWidgetService.fuguWidgetData.appSecretKey)d.app_secret_key=this.fuguWidgetService.fuguWidgetData.appSecretKey;else{if(!this.fuguWidgetService.fuguWidgetData.businessKey)throw new Error("no app_secret_key or business_unique_key provided");d.business_unique_key=this.fuguWidgetService.fuguWidgetData.businessKey}i&&(d.referral_url=i),a&&(d.marketing_campaign=a),this.fuguWidgetService.fuguWidgetData.uniqueId&&(d.user_unique_key=encodeURIComponent(this.fuguWidgetService.fuguWidgetData.uniqueId)),this.fuguWidgetService.fuguWidgetData.email&&(d.email=this.fuguWidgetService.fuguWidgetData.email),this.fuguWidgetService.fuguWidgetData.name&&(d.full_name=this.fuguWidgetService.fuguWidgetData.name),this.fuguWidgetService.fuguWidgetData.phone&&(d.phone_number=this.fuguWidgetService.fuguWidgetData.phone),this.fuguWidgetService.fuguWidgetData.customAttributes?d.custom_attributes=JSON.stringify(this.fuguWidgetService.fuguWidgetData.customAttributes)||JSON.stringify({}):d.custom_attributes=JSON.stringify({}),e&&(d.device_key=e);var l=this.getParameterByName(this.currentUrl,"utm_source"),g=this.getParameterByName(this.currentUrl,"utm_medium");return l&&(n.referral_url=l),g&&(n.marketing_campaign=g),d.attributes=JSON.stringify(n)||{},d.app_version_code=200,d},e.prototype.putUserDataForCustomer=function(){var e={};return this.fuguWidgetService.fuguWidgetData.customer_info.reseller_token&&(e.reseller_token=this.fuguWidgetService.fuguWidgetData.customer_info.reseller_token),this.fuguWidgetService.fuguWidgetData.customer_info.reference_id&&(e.reference_id=this.fuguWidgetService.fuguWidgetData.customer_info.reference_id),this.fuguWidgetService.fuguWidgetData.customer_info.user_unique_key&&(e.user_unique_key=this.fuguWidgetService.fuguWidgetData.customer_info.user_unique_key),this.fuguWidgetService.fuguWidgetData.appSecretKey&&(e.app_secret_key=this.fuguWidgetService.fuguWidgetData.appSecretKey),e.device_type=3,e.device_id=0,e},e.prototype.getUserBrowserDetails=function(){var e="";screen.width&&(e+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));var t,n,i,a=navigator.appVersion,o=navigator.userAgent,s=navigator.appName,r=""+parseFloat(navigator.appVersion),u=parseInt(navigator.appVersion,10);-1!=(n=o.indexOf("Opera"))&&(s="Opera",r=o.substring(n+6),-1!=(n=o.indexOf("Version"))&&(r=o.substring(n+8))),-1!=(n=o.indexOf("OPR"))?(s="Opera",r=o.substring(n+4)):-1!=(n=o.indexOf("Edge"))?(s="Microsoft Edge",r=o.substring(n+5)):-1!=(n=o.indexOf("MSIE"))?(s="Microsoft Internet Explorer",r=o.substring(n+5)):-1!=(n=o.indexOf("Chrome"))?(s="Chrome",r=o.substring(n+7)):-1!=(n=o.indexOf("Safari"))?(s="Safari",r=o.substring(n+7),-1!=(n=o.indexOf("Version"))&&(r=o.substring(n+8))):-1!=(n=o.indexOf("Firefox"))?(s="Firefox",r=o.substring(n+8)):-1!=o.indexOf("Trident/")?(s="Microsoft Internet Explorer",r=o.substring(o.indexOf("rv:")+3)):(t=o.lastIndexOf(" ")+1)<(n=o.lastIndexOf("/"))&&(s=o.substring(t,n),r=o.substring(n+1),s.toLowerCase()==s.toUpperCase()&&(s=navigator.appName)),-1!=(i=r.indexOf(";"))&&(r=r.substring(0,i)),-1!=(i=r.indexOf(" "))&&(r=r.substring(0,i)),-1!=(i=r.indexOf(")"))&&(r=r.substring(0,i)),u=parseInt(""+r,10),isNaN(u)&&(r=""+parseFloat(navigator.appVersion),u=parseInt(navigator.appVersion,10));var c=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(a),d=!!navigator.cookieEnabled;"undefined"!=typeof navigator.cookieEnabled||d||(document.cookie="testcookie",d=-1!=document.cookie.indexOf("testcookie"));var l="-",g=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var h in g){var p=g[h];if(p.r.test(o)){l=p.s;break}}var f="-";switch(/Windows/.test(l)&&(f=/Windows (.*)/.exec(l)[1],l="Windows"),l){case"Mac OS X":f=/Mac OS X (10[\.\_\d]+)/.exec(o)[1];break;case"Android":f=/Android ([\.\_\d]+)/.exec(o)[1];break;case"iOS":f=(f=/OS (\d+)_(\d+)_?(\d+)?/.exec(a))[1]+"."+f[2]+"."+(0|f[3])}var _=navigator.language,m=window.location.href,v={screen:e,browser:s,browserVersion:r,browserMajorVersion:u,mobile:c,os:l,osVersion:f,cookies:d,browserLanguage:_,browserUrl:m=(m=m.replace("https://","")).replace("http://","")},y={"Browser Version":v.browserVersion,Browser:v.browser+" "+v.browserMajorVersion,"Browser Language":v.browserLanguage,OS:v.os+" "+v.osVersion,"Cookies Enabled":v.cookies,"Screen Size":v.screen,Source:v.browserUrl};return JSON.stringify(y)},e.prototype.makeid=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<10;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e+=(new Date).getTime()},e.prototype.getCookie=function(e){var t=localStorage.getItem("fuguWidget");t&&(t=JSON.parse(t));var n=this.website_host;if(t&&n&&Object.keys(t).indexOf(n)>-1){var i=t[n][e];return i||""}return""},e.prototype.setCookie=function(e,t,n){new Date;var i=this.website_host,a=localStorage.getItem("fuguWidget");a?((a=JSON.parse(a))[i]||(a[i]={}),a[i][e]=t):((a={})[i]={},a[i][e]=t),localStorage.setItem("fuguWidget",JSON.stringify(a))},e.prototype.updateUserDetails=function(e){this.userDetails.business_name=e.business_name,this.userDetails.full_name=e.full_name,this.userDetails.user_channel=e.user_channel,this.userDetails.user_id=e.user_id,this.userDetails.user_unique_key=e.user_unique_key||"",this.userDetails.en_user_id=e.en_user_id||"",this.userDetails.access_token=e.access_token,this.userDetails.max_file_size=e.max_file_size},e.prototype.updateConfigDetails=function(e){this.configData["button-new_conversation_visible"]=e["button-new_conversation_visible"],this.configData["color-background"]=e["color-background"],this.configData["color-text"]=e["color-text"],this.configData["color-theme"]=e["color-theme"],this.configData["color-title_bar"]=e["color-title_bar"],this.configData.push_based_on_chat=e.push_based_on_chat,this.configData["keys-external_api_custom_detail"]=e["keys-external_api_custom_detail"],this.configData["text-subtitle"]=e["text-subtitle"],this.configData["text-title"]=e["text-title"],this.configData.business_image=e.business_image,this.configData["background-color-theme"]=e["background-color-theme"],this.configData["typing-allignment"]=e["typing-allignment"],this.configData.show_widget_default_channel=!!+e.show_widget_default_channel},e.prototype.userLogout=function(e){var t=this,n=this.getCookie("f_uid"),i=this.website_host;if(n){var a="app_secret_key="+encodeURIComponent(this.fuguWidgetService.fuguWidgetData.appSecretKey)+"&en_user_id="+this.userDetails.en_user_id;this.fuguWidgetService.logOutUser(a).takeWhile(function(){return t.alive}).subscribe(function(e){console.log("logout success"),t.postMessageToParentWindow({type:"Shutdown",data:{}})},function(e){console.log("logout error"),t.postMessageToParentWindow({type:"Shutdown",data:{}})})}else this.postMessageToParentWindow({type:"Shutdown",data:{}});localStorage.removeItem("f_uid_Id"),localStorage.removeItem("f_uid");var o=localStorage.getItem("fuguWidget");o&&(delete(o=JSON.parse(o))[i],localStorage.setItem("fuguWidget",JSON.stringify(o)))},e.prototype.getParameterByName=function(e,t){t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},Object.defineProperty(e.prototype,"f_uid_Id",{get:function(){var e=localStorage.getItem("fuguWidget"),t=this.website_host;return e&&(e=JSON.parse(e))[t]&&e[t].f_uid_Id||""},set:function(e){var t=localStorage.getItem("fuguWidget"),n=this.website_host;t?((t=JSON.parse(t))[n]||(t[n]={}),t[n].f_uid_Id=e):((t={})[n]={},t[n].f_uid_Id=e),localStorage.setItem("fuguWidget",JSON.stringify(t))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"website_host",{get:function(){var e=this.hostname,t=this.hostname.split(".").length-1,n=e.indexOf(".");return t>1&&(e=e.replace(e.substring(0,n+1),"")),e},enumerable:!0,configurable:!0}),e.prototype.fireAllErrors=function(e){var t=this;Object.keys(e.controls).forEach(function(n){var i=e.get(n);i instanceof o.g?(i.markAsTouched({onlySelf:!0}),i.markAsDirty({onlySelf:!0})):i instanceof o.i?t.fireAllErrors(i):i instanceof o.d&&i.controls.forEach(function(e){t.fireAllErrors(e)})})},e.prototype.playNotificationSound=function(e){document.getElementById("sound").innerHTML='<audio autoplay="autoplay"><source src="'+e+'.mp3" type="audio/mpeg" /><source src="'+e+'.ogg" type="audio/ogg" /><embed hidden="true" autostart="true" loop="false" src="'+e+'.mp3" /></audio>'},e.prototype.updateAndEmitUnreadCountOnFaye=function(e,t){"0"!=t?(this.channelwiseUnreadCount[e]?this.customerwiseUnreadCount[t]||(this.customerwiseUnreadCount[t]=this.channelwiseUnreadCount[e].unreadCount,-1==this.channelwiseUnreadCount[e].customersInvolved.indexOf(t)&&this.channelwiseUnreadCount[e].customersInvolved.push(t)):this.channelwiseUnreadCount[e]={customersInvolved:[t],unreadCount:0},this.customerwiseUnreadCount[t]||(this.customerwiseUnreadCount[t]=0),this.customerwiseUnreadCount[t]+=1,this.channelwiseUnreadCount[e].unreadCount+=1):(this.channelwiseUnreadCount[e]||(this.channelwiseUnreadCount[e]={customersInvolved:[],unreadCount:0}),this.channelwiseUnreadCount[e].unreadCount+=1),this.totalUnreadCount+=1,this.postMessageToParentWindow({type:"UnreadCount",data:this.customerwiseUnreadCount}),this.postMessageToParentWindow({type:"TotalUnreadCount",data:this.totalUnreadCount})},e.prototype.recalculateUnreadCount=function(e){var t=this;this.channelwiseUnreadCount[e]?this.channelwiseUnreadCount[e].customersInvolved.length&&this.channelwiseUnreadCount[e].customersInvolved.map(function(n){t.customerwiseUnreadCount[n]&&(t.customerwiseUnreadCount[n]-=t.channelwiseUnreadCount[e].unreadCount,t.customerwiseUnreadCount[n]<0&&(t.customerwiseUnreadCount[n]=0))}):this.channelwiseUnreadCount[e]={customersInvolved:[],unreadCount:0},this.totalUnreadCount-=this.channelwiseUnreadCount[e].unreadCount,this.channelwiseUnreadCount[e].unreadCount=0,this.postMessageToParentWindow({type:"UnreadCount",data:this.customerwiseUnreadCount}),this.postMessageToParentWindow({type:"TotalUnreadCount",data:this.totalUnreadCount})},e.prototype.ngOnDestroy=function(){this.alive=!1},e.ctorParameters=function(){return[{type:a.a}]},e}()},0:function(e,t,n){e.exports=n("x35b")},"2CBl":function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n("3j3K"),a=n("AFGG"),o=n("zCXK"),s=n("+KvB"),r=n("p3n4"),u=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function s(e){try{u(i.next(e))}catch(e){o(e)}}function r(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(s,r)}u((i=i.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,i,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return{next:s(0),throw:s(1),return:s(2)};function s(s){return function(r){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(a=i[2&s[0]?"return":s[0]?"throw":"next"])&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[0,a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,r])}}},d=function(){function e(e,t,a){this.fayeService=e,this.commonService=t,this.fuguWidgetService=a,this.alive=!0,this.active_channel_object=null,this.uploadImageEmitter=new i.p,this.uploadingTextEmitter=new i.p,this.uuidv4=n("DtRx")}return e.prototype.filesUpload=function(e,t,n){var i=this;if(e){if(e.size>this.commonService.userDetails.max_file_size)return void alert("File size should be smaller than "+(this.commonService.userDetails.max_file_size/1024/1024).toFixed(0)+" mb.");var a=e.type||"application/octet-stream",s=a.split("/"),r=new FormData;r.append("allow_all_mime_type",!0),r.append("access_token",this.commonService.userDetails.access_token),r.append("file_type",a),r.append("file",e);var d=e.name.replace(/\,/g,"_");r.append("file_name",d),this.uploadingTextEmitter.emit(!0);var l=JSON.parse(JSON.stringify(t));this.fuguWidgetService.sendImage(r).takeWhile(function(){return i.alive}).subscribe(function(t){return u(i,void 0,void 0,function(){var i,a,r,u,g,h;return c(this,function(c){switch(c.label){case 0:return n&&this.uploadingTextEmitter.emit(!1),i=(i=moment().utc().format()).replace("Z",".000Z"),a={message:"",full_name:this.commonService.userDetails.full_name,user_id:this.commonService.userDetails.user_id,date_time:i,is_typing:o.f.Typing_End,user_type:o.g.Customer,file_name:d,message_status:o.c.Sent,thumbnail_url:t.data.thumbnail_url},"image"!=s[0]||["vnd.adobe.photoshop","psd","tiff"].includes(s[1])?[3,2]:(h={message_type:o.d.Image_Message,image_url:t.data.image_url},u=(r=Object).assign,g=[h],[4,this.getImageHeightWidth(e)]);case 1:return h=u.apply(r,g.concat([c.sent()])),a=Object.assign(a,h),[3,3];case 2:h={message_type:o.d.File_Message,url:t.data.url,document_type:this.checkFileType(s),file_size:this.calculateFileSize(e.size)},a=Object.assign(a,h),c.label=3;case 3:return l.channel_id==this.active_channel_object.channel_id&&this.active_channel_object.channel_id>-1?this.uploadImageEmitter.emit(a):-1!=l.channel_id&&(a.muid=this.uuidv4(),this.fayeService.publishOnChannel(l.channel_id,a)),[2]}})})},function(e){e.json()})}},e.prototype.calculateFileSize=function(e){var t=Math.floor(Math.log(e)/Math.log(1024));return e?(e/Math.pow(1024,t)).toFixed(2)+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]:"0 Bytes"},e.prototype.getImageHeightWidth=function(e){return new Promise(function(t,n){var i=new FileReader;i.readAsDataURL(e),i.onload=function(e){var n=new Image;n.src=e.target.result,n.onload=function(){t({image_width:n.width,image_height:n.height})}}})},e.prototype.checkFileType=function(e){return["audio","video"].includes(e[0])&&!["ogg"].includes(e[1])?e[0]:"file"},e.prototype.ngOnDestroy=function(){this.alive=!1},e.ctorParameters=function(){return[{type:a.a},{type:s.a},{type:r.a}]},e}()},"6GLz":function(e,t,n){var i={"./modules/layout/layout.module.ngfactory":["k+8m",0],"./modules/payment-request/payment-request.module.ngfactory":["vEvk",1]};function a(e){var t=i[e];return t?n.e(t[1]).then(function(){return n(t[0])}):Promise.reject(new Error("Cannot find module '"+e+"'."))}a.keys=function(){return Object.keys(i)},a.id="6GLz",e.exports=a},AFGG:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n("3j3K"),a=(n("owTz"),n("kZql")),o=n("+KvB"),s=n("p3n4"),r=n("zCXK"),u=function(){function e(e,t){this.commonService=e,this.fuguWidgetService=t,this.isFayeConnected=!1,this._destroyCheck=!1,this.pingInterval=0,this.chatNonReassignEvent=new i.p,this.activeChannelIdMessageEvent=new i.p,this.activeChannelIdTypingEvent=new i.p,this.activeChannelIdMessageSentEvent=new i.p,this.readAllEvent=new i.p,this.messageDeliveredEvent=new i.p,this.messageReadEvent=new i.p,this.fayeConnectionEvent=new i.p}return e.prototype.userChannelSubCallback=function(e){switch(e.notification_type){case r.e.Chat_Reassign:this.chatReassigned(e);break;default:this.otherEvent(e)}},e.prototype.chatReassigned=function(e){},e.prototype.otherEvent=function(e){this.chatNonReassignEvent.emit(e)},e.prototype.subscribeToChannel=function(e){var t=this;this.unsubscribeToActiveChannel(),this.activeChannelId=e,this.active_channel_id_subscription=this.client.subscribe("/"+this.activeChannelId,function(e){t.activeChannelIdSubCallback(e)})},e.prototype.activeChannelIdSubCallback=function(e){switch(e.notification_type){case r.e.Read_All:a.a.production||console.log("Faye Service => active channel Message Read response:",e),this.messageReadEvent.emit(e);break;default:switch(e.is_typing){case r.f.Typing_Start:case r.f.Typing_Stopped:this.activeChannelIdTypingEvent.emit(e);break;case r.f.Typing_End:a.a.production||console.log("Faye Service => active channel response: ",e),this.activeChannelIdMessageEvent.emit(e)}}},e.prototype.unsubscribeToActiveChannel=function(){this.active_channel_id_subscription&&(this.active_channel_id_subscription.cancel(),this.active_channel_id_subscription.unsubscribe(),this.activeChannelId=0)},e.prototype.sendMessage=function(e){var t=this,n=e.is_typing==r.f.Typing_End,i=-1;n&&(i=e.index);this.client.publish("/"+this.activeChannelId,e,{deadline:18,attempts:1}).then(function(e){n&&-1!=i&&t.activeChannelIdMessageSentEvent.emit({index:i})},function(e){console.log("message sending failed!")})},e.prototype.publishOnChannel=function(e,t){return t.device_payload={device_details:navigator.userAgent,device_id:this.commonService.f_uid_Id,device_type:3},this.client.publish("/"+e,t,{attempts:1}).then(function(e){},function(e){throw console.log("message sending failed! "+JSON.stringify(e.message)),e})},e.prototype.setupSchedular=function(){var e=this,t=function(){Faye.Scheduler.apply(this,arguments)};return(t.prototype=Object.create(Faye.Scheduler.prototype)).send=function(){if("/meta/handshake"==this.message.channel||"/meta/connect"==this.message.channel)try{this.message.ext={user_id:e.commonService.userDetails.user_id,device_type:3,source:4}}catch(e){console.log("Faye Before send ",e)}Faye.Scheduler.prototype.send.apply(this,arguments)},t.prototype.fail=function(){Faye.Scheduler.prototype.fail.apply(this,arguments),this.message.channel=="/"+this.activeChannelId&&console.log("Failed message:",this.message)},t.prototype.succeed=function(){Faye.Scheduler.prototype.succeed.apply(this,arguments),this.message.channel=="/"+this.activeChannelId&&console.log("succeeded\xce message:",this.message)},t},e.prototype.appSecretKeySubCallback=function(e,t){var n=this;switch(t.notification_type){case r.e.Read_All:t.user_type==r.g.Agent&&t.channel_id==this.activeChannelId&&this.readAllEvent.emit(t);break;case r.e.Read_Unread:t.channel_id==this.activeChannelId&&(t.delivered_at?this.messageDeliveredEvent.emit(t):this.messageReadEvent.emit(t));break;case r.e.User_Migration:var i=this.commonService.userDetails.user_id;console.log("Widget Faye Migration: ",t),i!=t.migrated_to&&i!=t.user_id||(console.log("valid user migration"),this.fuguWidgetService.putUserDetails(this.commonService.putUserData()).takeWhile(function(){return n.alive}).subscribe(function(e){var t=e.data.device_key;if(n.commonService.setCookie("f_uid",t,10),n.commonService.updateUserDetails(e.data),n.commonService.postMessageToParentWindow({type:"Collapse"}),n.unsubscribeAllSubscriptions(!1),n.setupSubscriptions(),n.commonService.userDetails.user_unique_key.length>1)n.commonService.isConversationListValid=Object.keys(e.data.conversations).length>0;else{var i=e.data.conversations.filter(function(e){return-1!=e.channel_id});n.commonService.isConversationListValid=0!=i.length}}));break;case r.e.User_Logout:if(t.user_id==this.commonService.userDetails.user_id){localStorage.removeItem("f_uid_Id"),localStorage.removeItem("f_uid");var a=localStorage.getItem("fuguWidget");a&&(delete(a=JSON.parse(a))[this.commonService.website_host],localStorage.setItem("fuguWidget",JSON.stringify(a))),this.unsubscribeAllSubscriptions(!0),this.commonService.postMessageToParentWindow({type:"Shutdown",data:{}})}}},e.prototype.sendAck_Delivered=function(e){var t="/"+this.fuguWidgetService.fuguWidgetData.appSecretKey+"/readUnread";this.client.publish(t,e).then(function(e){},function(e){console.log("failed to send delivered msg to server")})},e.prototype.sendAck_Read=function(e){var t="/"+this.activeChannelId;this.client.publish(t,e).then(function(e){},function(e){console.log("failed to send read msg to server")})},e.prototype.setupSubscriptions=function(){var e=this;if(this.logError("from AgentWidget => logging in user ",new Date),this.unsubscribeAllSubscriptions(this._destroyCheck),!this._destroyCheck){var t=this.setupSchedular();this.client=new Faye.Client(""+a.a.FAYE_ENDPOINT,{scheduler:t,timeout:20,retry:2,interval:20}),this.client.disable("autodisconnect"),this.user_channel_subscription=this.client.subscribe("/"+this.commonService.userDetails.user_channel,function(t){a.a.production||console.log("in FayeService => UserChannelSubs",t),e.userChannelSubCallback(t)});this.client.on("transport:down",function(){var t=new Date,n=" Faye disconnected =>  "+t.toLocaleTimeString();console.log(n),e.isFayeConnected=!1,e.fayeConnectionEvent.emit(!1),e.ping(),e.pingInterval=setInterval(function(){e._destroyCheck?clearInterval(e.pingInterval):e.ping()},2e3),e.logError(n,t)}),this.client.on("transport:up",function(){var t=new Date,n=" Faye connected =>  "+t.toLocaleTimeString();console.log(n),e.isFayeConnected=!0,e.fayeConnectionEvent.emit(!0),clearInterval(e.pingInterval),e.logError(n,t)}),console.log("Faye service => Subscribed all channels")}},e.prototype.unsubscribeAllSubscriptions=function(e,t){this._destroyCheck=e,e&&this.logError(t,new Date),this.active_channel_id_subscription&&(this.active_channel_id_subscription.cancel(),this.active_channel_id_subscription.unsubscribe()),this.user_channel_subscription&&(this.user_channel_subscription.cancel(),this.user_channel_subscription.unsubscribe()),this.app_secret_key_subscription&&(this.app_secret_key_subscription.cancel(),this.app_secret_key_subscription.unsubscribe()),this.client&&(this.client.unsubscribe(),this.client.disconnect()),this.activeChannelId=0,console.log("Faye service => unsubscribed all channels")},e.prototype.ping=function(){if(!this._destroyCheck&&this.commonService.userDetails.user_id){var e=moment().utc().format(),t={message:"",full_name:this.commonService.userDetails.full_name,user_id:this.commonService.userDetails.user_id,date_time:e,is_typing:r.f.Typing_Stopped,message_type:r.d.Customer_Agent_Message,user_type:r.g.Customer,on_subscribe:1};this.sendMessage(t)}},e.prototype.ngOnDestroy=function(){this.unsubscribeAllSubscriptions(!0),this.alive=!1},e.prototype.logError=function(e,t){console.log("widget Faye exceptions: ",e)},e.ctorParameters=function(){return[{type:o.a},{type:s.a}]},e}()},"NG/o":function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){return function(){}}()},PP02:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e.getValidatorErrorMessage=function(e,t){return{required:"This field is required.",invalidCreditCard:"Please enter a valid credit card number.",invalidEmailAddress:"Please enter a valid email address.",invalidPassword:"Please enter a valid password. Password must be at least 6 characters long, and contain a number.",minlength:"This field must be "+t.requiredLength+" characters long.",maxlength:"This field must be "+t.requiredLength+" characters long.",min:"This field must be greater than "+(t.min-1)+".",max:"This field must be less than "+(t.max+1)+".",invalidPhoneNumber:"Please enter a valid phone number.",invalidZipCode:"Please enter a valid ZIP Code.",invalidVIN:"Please enter a valid VIN.",invalidWeight:"Weight value should not exceed 250.",invalidCapacity:"Vehicle Capcity should not exceed 5500.",invalidOTP:"Please enter a valid OTP",pattern:"Invalid characters"}[e]},e.creditCardValidator=function(e){return e.value.match(/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/)?null:{invalidCreditCard:!0}},e.emailValidator=function(e){return e.value.match(/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/)||""==e.value?null:{invalidEmailAddress:!0}},e.alternateEmailValidator=function(e){return""==e.value?null:e.value.match(/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/)||""==e.value?null:{invalidEmailAddress:!0}},e.passwordValidator=function(e){},e.phoneNumberValidator=function(e){return e.value.match(/^(?:(?:\(?(?:00|\+)([1-4]\d\d|[1-9]\d?)\)?)?[\-\.\ \\\/]?)?((?:\(?\d{1,}\)?[\-\.\ \\\/]?){0,})(?:[\-\.\ \\\/]?(?:#|ext\.?|extension|x)[\-\.\ \\\/]?(\d+))?$/i)&&10==e.value.length||""==e.value?null:{invalidPhoneNumber:!0}},e.zipCodeValidator=function(e){return e.value.match(/^[a-zA-Z0-9 ]*$/)?null:{invalidZipCode:!0}},e.NumberValidator=function(e){return e.value.match(/^[0-9 ]*$/)?null:{invalidOTP:!0}},e.mobileNumberValidator=function(e){return e.value.match(/^[7-9]{1}[0-9]{9}$/)?null:{invalidPhoneNumber:!0}},e.VINValidator=function(e){return 17==e.value.length?null:{invalidVIN:!0}},e.capacityValidator=function(e){return parseInt(e.value)>5500?{invalidCapacity:!0}:null},e.weightValidator=function(e){return parseInt(e.value)>250?{invalidWeight:!0}:null},e.patternValidator=function(e,t){return e.value.match(t)||""==e.value?null:{"invalid characters":!0}},e}()},kZql:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i={production:!0,API_ENDPOINT:"https://hippo-backend.techataclick.com:3008/api/",FAYE_ENDPOINT:"https://faye.techataclick.com:3021/faye"}},p3n4:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n("3j3K"),a=n("Fzro"),o=(n("owTz"),n("kZql")),s=function(){function e(e){this.http=e,this.configFetchEvent=new i.p}return Object.defineProperty(e.prototype,"fuguWidgetData",{get:function(){return this._fuguWidgetData},set:function(e){this._fuguWidgetData=e},enumerable:!0,configurable:!0}),e.prototype.putUserDetails=function(e){e=Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&");var t=new a.d;return t.append("Content-Type","application/x-www-form-urlencoded"),this.http.post(o.a.API_ENDPOINT+"users/putUserDetails",e.trim(),{headers:t}).map(function(e){return e.json()})},e.prototype.putUserDetailsReseller=function(e,t){t&&(e.neglect_conversations=t),e=Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&");var n=new a.d;return n.append("Content-Type","application/x-www-form-urlencoded"),this.http.post(o.a.API_ENDPOINT+"reseller/putUserDetails",e.trim(),{headers:n}).map(function(e){return e.json()})},e.prototype.getGroupingTags=function(e){return e.length?e.map(function(e){return{reseller_team_id:e.toString()}}):[]},e.prototype.agentLoginViaAuthToken=function(){var e={auth_token:this.fuguWidgetData.access_token};return this.http.post(o.a.API_ENDPOINT+"agent/v1/agentLoginViaAuthToken",e).map(function(e){return JSON.parse(e._body)})},e.prototype.agentLoginViaSecretKey=function(){var e={agent_secret_key:this.fuguWidgetData.agent_secret_key};return this.http.post(o.a.API_ENDPOINT+"agent/getAgentLoginInfo",e).map(function(e){return JSON.parse(e._body)})},e.prototype.getConfigurations=function(e){var t={access_token:e};return this.http.post(o.a.API_ENDPOINT+"business/getConfiguration",t).map(function(e){return JSON.parse(e._body)})},e.prototype.authenticateViaAccessToken=function(e){var t={access_token:e,device_id:localStorage.getItem("device_uuid")};return this.http.post(o.a.API_ENDPOINT+"agent/agentLogin",t).map(function(e){return JSON.parse(e._body)})},e.prototype.getUnreadCount=function(e,t){if(this.fuguWidgetData.user_unique_keys){var n={access_token:this.fuguWidgetData.access_token};return e.length&&(n.user_unique_keys=e),t&&(n.neglect_total_unread_count=!0),this.http.post(o.a.API_ENDPOINT+"conversation/getUnreadCount",n).map(function(e){return JSON.parse(e._body)})}},e.prototype.findIP=function(){var e=new a.d;return e.append("Content-Type","application/x-www-form-urlencoded"),this.http.get("https://jsonip.com",{headers:e}).map(function(e){return e.json()})},e.prototype.getConversations=function(e,t,n,i){var a={access_token:e,en_user_id:t,type:[0,3],status:[1],label:[],channel_filter:[],page_start:i,append_channel_id:-1};return n&&(a.search_user_id=n),this.http.post(o.a.API_ENDPOINT+"conversation/v1/getConversations",a).map(function(e){return JSON.parse(e._body)})},e.prototype.getMessages=function(e){var t={access_token:e.access_token,channel_id:e.channelId,en_user_id:e.user_id,page_start:e.page_start};return this.http.post(o.a.API_ENDPOINT+"conversation/getMessages",t).map(function(e){return JSON.parse(e._body)})},e.prototype.adminToUserChat=function(e){return this.http.post(o.a.API_ENDPOINT+"conversation/createConversation",e).map(function(e){return JSON.parse(e._body)})},e.prototype.createOneToOneChat=function(e,t){var n={access_token:e};return t.email?n.chat_with_email=t.email:t.user_id&&(n.chat_with_user_id=t.user_id),this.http.post(o.a.API_ENDPOINT+"chat/createOneToOneChat",n).map(function(e){return JSON.parse(e._body)})},e.prototype.createConversation=function(e,t,n){var i=new a.d,s="app_secret_key="+encodeURIComponent(this.fuguWidgetData.appSecretKey)+"&label_id="+e+"&en_user_id="+t+"&source=4";if(n&&Object.keys(n)){if(n.tags&&n.tags.length){var r=n.tags.map(function(e){return e.toString()});s+="&tags="+JSON.stringify(r)}if(n.custom_label&&(s+="&custom_label="+n.custom_label),n.transaction_id&&(s+="&transaction_id="+n.transaction_id),n.user_unique_key&&(s+="&user_unique_key="+n.user_unique_key),n.other_user_unique_key){var u=n.tags.map(function(e){return e.toString()});s+="&other_user_unique_key="+JSON.stringify(u)}n.chat_type&&(s+="&chat_type="+n.chat_type)}return i.append("Content-Type","application/x-www-form-urlencoded"),this.http.post(o.a.API_ENDPOINT+"conversation/createConversation",s,{headers:i}).map(function(e){return e.json()})},e.prototype.sendImage=function(e){var t=new a.d;return t.append("Accept","application/json"),this.http.post(o.a.API_ENDPOINT+"conversation/uploadFile",e,{headers:t}).map(function(e){return e.json()})},e.prototype.logOutUser=function(e){var t=new a.d;return t.append("Content-Type","application/x-www-form-urlencoded"),this.http.post(o.a.API_ENDPOINT+"users/userlogout",e,{headers:t}).map(function(e){return e.json()})},e.prototype.newConversationWithBotMessage=function(e,t){var n=new a.d,i=this.fuguWidgetData.tags,s="app_secret_key="+encodeURIComponent(this.fuguWidgetData.appSecretKey)+"&chat_type=0&en_user_id="+e+"&bot_default_message="+t;return i&&(s+="&tags="+JSON.stringify(i)),n.append("Content-Type","application/x-www-form-urlencoded"),this.http.post(o.a.API_ENDPOINT+"conversation/createConversation",s,{headers:n}).map(function(e){return e.json()})},e.prototype.receiveBotAction=function(e){var t=new a.d;return this.http.post(o.a.API_ENDPOINT+"bot/receiveBotAction",e,{headers:t}).map(function(e){return e.json()})},e.prototype.getWhitelabelInfo=function(e){return this.http.get(o.a.API_ENDPOINT+"business/whitelabelProperties?url="+e).map(function(e){return e.json()})},e.ctorParameters=function(){return[{type:a.e}]},e}()},x35b:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("3j3K"),o=n("kZql"),s=n("Qbdm"),r=this&&this.__extends||(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.overrides={pinch:{enable:!1},rotate:{enable:!1}},t}return r(t,e),t}(s.g),c=function(){return function(){}}(),d=n("5oXY"),l=n("+KvB"),g=n("p3n4"),h=n("AFGG"),p=n("zCXK"),f=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},_=function(){function e(e,t,n,i){this.router=e,this.commonService=t,this.fuguWidgetService=n,this.fayeService=i,this.closedFromChat=!1,this.debug=!1,this._collpased=!0,this.alive=!0,this.previousRoute="conversations"}return Object.defineProperty(e.prototype,"collapsed",{get:function(){return this._collpased},set:function(e){this._collpased=e,e?this.router.navigate(["conversations",{closedFromChat:this.closedFromChat}],{skipLocationChange:!0}):this.commonService.isConversationListValid?this.router.navigate([this.previousRoute],{skipLocationChange:!0}):this.router.navigate(["conversations"],{skipLocationChange:!0})},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.fuguWidgetService.findIP().takeWhile(function(){return e.alive}).subscribe(function(t){console.log("Your ip: "+t.ip),e.commonService.ip=t.ip},function(e){console.log("get ip error")}),this.fuguWidgetService.configFetchEvent.takeWhile(function(){return e.alive}).subscribe(function(t){e.commonService.updateConfigDetails(t.data),e.fuguWidgetService.fuguWidgetData.color&&(t.data["color-theme"]=e.fuguWidgetService.fuguWidgetData.color),e.commonService.postMessageToParentWindow({type:"Config",data:t.data}),document.documentElement.style.setProperty("--color",t.data["color-theme"])}),window.app=this},e.prototype.onWindowOffline=function(e){if(e.data.type&&e.origin==e.data.parent_origin)switch(this.commonService.parentOrigin=e.data.parent_origin,this.commonService.currentUrl=e.data.current_url,o.a.production&&!this.debug||console.log("ng-App-Hostlistener: ",e),e.data.type){case"Expand":this.collapsed=!1;break;case"Collapse":e.data&&e.data.data&&e.data.data.closedFromChat?this.closedFromChat=!0:this.closedFromChat=!1,this.collapsed=!0;break;case"Init":if(this.fuguWidgetService.fuguWidgetData=e.data.data,this.commonService.hostname=e.data.hostname,this.fuguWidgetService.fuguWidgetData.customWhitelabelPointing){var t=new URL(this.commonService.currentUrl);o.a.API_ENDPOINT=t.origin+"/widget/api/",o.a.FAYE_ENDPOINT=t.origin+"/widget/faye"}this.fuguWidgetService.fuguWidgetData.is_fork?this.initForkedAgentWidget():this.initAgentWidget();break;case"Shutdown":this.fayeService.unsubscribeAllSubscriptions(!0),this.commonService.userLogout(e.data.data.hostname);break;case"StartConversation":this.createUniqueConversation(e.data.data.data||e.data.data);break;case"StartPeerToPeerConversation":this.createPeerToPeerConversation(e.data.data.data||e.data.data);break;case"ConfigCompleted":this.commonService.postMessageToParentWindow({type:"SetupComplete",data:{}});break;case"Blur":this.commonService.iPadState=!1;break;case"BotMessage":this.newConversationWithBotMessage(e.data.data);break;case"OpenConversation":this.fuguWidgetService.fuguWidgetData=f({},this.fuguWidgetService.fuguWidgetData,e.data.data),this.commonService.postMessageToParentWindow({type:"Expand",data:{}}),this.openCustomerConversation();break;case"OpenMyConversation":this.commonService.postMessageToParentWindow({type:"Expand",data:{}}),this.commonService.openAgentConversations.emit();break;case"NewCustomerOnline":this.onNewCustomer(e.data.data);break;case"StartOneToOneChat":this.startOneToOneChat(e.data.data.data);break;case"StartChatWithCustomer":this.startChatWithCustomer(e.data.data.data)}},e.prototype.createPeerToPeerConversation=function(e){var t=this,n=JSON.parse(JSON.stringify(e));n.chat_type=p.a.p2p,n.en_user_id=this.commonService.userDetails.en_user_id,this.fuguWidgetService.createConversation(-1,this.commonService.userDetails.en_user_id,n).takeWhile(function(){return t.alive}).subscribe(function(e){var n=e.data.channel_id;t.router.navigate(["chat/"+n],{queryParams:{label_id:-1},skipLocationChange:!0})},function(e){console.log("createConversation: ",e.json())})},e.prototype.startOneToOneChat=function(e){var t=this;if(void 0===e.user_id&&void 0===e.email)throw new Error("Neither email nor userid provided");this.fuguWidgetService.createOneToOneChat(this.fuguWidgetService.fuguWidgetData.access_token,e).subscribe(function(e){var n=e.data.channel_id;t.router.navigate(["chat/"+n],{queryParams:{label_id:-1},skipLocationChange:!0})},function(e){console.log("createOneToOneChat Error: ",e.json())})},e.prototype.startChatWithCustomer=function(e){var t=this;if(void 0===e.customer_unique_keys)throw new Error("No user id provided");if(void 0===e.transaction_id)throw new Error("No transaction id provided");var n={access_token:this.commonService.userDetails.access_token,initiator_en_agent_id:this.commonService.userDetails.en_user_id,other_user_unique_key:e.customer_unique_keys,transaction_id:e.transaction_id,chat_type:0};e.custom_label&&(n.custom_label=e.custom_label),this.fuguWidgetService.adminToUserChat(n).takeWhile(function(){return t.alive}).subscribe(function(e){var n=e.data.channel_id;t.router.navigate(["chat/"+n],{queryParams:{label_id:-1},skipLocationChange:!0})},function(e){console.log("create new conversation error")})},e.prototype.createUniqueConversation=function(e){var t=this,n=JSON.parse(JSON.stringify(e));n.custom_label?n.custom_label:this.commonService.userDetails.business_name,n.transaction_id||this.commonService.userDetails.user_id||!n.defaultMessage?n.transaction_id&&this.commonService.userDetails.user_id&&this.fuguWidgetService.createConversation(-1,this.commonService.userDetails.en_user_id,n).takeWhile(function(){return t.alive}).subscribe(function(e){var i=e.data.channel_id;return n.defaultMessage?(t.commonService.defaultMessageToPublish=n.defaultMessage,n.singleDefaultMessage?t.router.navigate(["chat/"+i],{queryParams:{label_id:-1,publish_message:!0,publish_once:!0},skipLocationChange:!0}):t.router.navigate(["chat/"+i],{queryParams:{label_id:-1,publish_message:!0},skipLocationChange:!0})):t.router.navigate(["chat/"+i],{queryParams:{label_id:-1,publish_message:!1},skipLocationChange:!0})},function(e){console.log("createConversation: ",e.json())}):this.fuguWidgetService.createConversation(-1,this.commonService.userDetails.en_user_id,n).takeWhile(function(){return t.alive}).subscribe(function(e){var n=e.data.channel_id;t.router.navigate(["chat/"+n],{queryParams:{label_id:-1},skipLocationChange:!0})},function(e){console.log("createConversation: ",e.json())})},e.prototype.newConversationWithBotMessage=function(e){var t=this;this.fuguWidgetService.newConversationWithBotMessage(this.commonService.userDetails.en_user_id,e).subscribe(function(n){t.commonService.newConversationInitiated.emit({message:e}),t.agentLoginViaAuthToken()},function(e){console.log(e.json())})},e.prototype.onNewCustomer=function(e){var t=this;this.fuguWidgetService.getUnreadCount(e,!0).subscribe(function(e){var n=e.data.agent_customer_unread_count;Object.keys(n).map(function(e){var i=0;Object.keys(n[e]).map(function(a){i+=n[e][a],-1==t.commonService.channelwiseUnreadCount[a].customersInvolved.indexOf(e)&&t.commonService.channelwiseUnreadCount[a].customersInvolved.push(e)}),t.commonService.customerwiseUnreadCount[e]=i}),t.commonService.postMessageToParentWindow({type:"UnreadCount",data:t.commonService.customerwiseUnreadCount})})},e.prototype.agentLoginViaAuthToken=function(){var e=this;if(this.fuguWidgetService.fuguWidgetData.access_token){this.fuguWidgetService.fuguWidgetData.customer_info=this.fuguWidgetService.fuguWidgetData.customer_info?this.fuguWidgetService.fuguWidgetData.customer_info:{};var t=!!this.fuguWidgetService.fuguWidgetData.businessKey;this.router.navigate(["/conversations"]),this.fuguWidgetService.agentLoginViaAuthToken().takeWhile(function(){return e.alive}).subscribe(function(n){var i=n.data.access_token,a=n.data.user_id,o=n.data.full_name;e.commonService.userDetails.access_token=i,e.commonService.userDetails.customer_id=a,e.commonService.userDetails.en_user_id=n.data.en_user_id,e.commonService.userDetails.searched_full_name=o,e.fuguWidgetService.getConfigurations(i).takeWhile(function(){return e.alive}).subscribe(function(t){console.log(t),e.fuguWidgetService.configFetchEvent.emit(t)},function(e){console.log("get config error: ",e.json())});var s=n.data.conversations||null;e.fuguWidgetService.authenticateViaAccessToken(i).takeWhile(function(){return e.alive}).subscribe(function(n){t&&(e.fuguWidgetService.fuguWidgetData.appSecretKey=n.data.app_secret_key),e.commonService.updateUserDetails(n.data),e.fayeService.setupSubscriptions(),s&&200==s.statusCode&&s.data&&s.data.conversation_list.length?(e.commonService.customerConversations=s.data.conversation_list,e.commonService.customeConversationsChanged.emit()):e.router.navigate(["/chat/-1"],{queryParams:{customer_id:a}})},function(e){console.log("agent login error: ",e.json())})})}},e.prototype.checkArrowPosition=function(e){console.log("pos"+JSON.stringify(e.data));var t=document.getElementById("arrow");t.style.borderLeft=null,t.style.borderRight=null,t.style.borderTop=null,t.style.borderBottom=null;var n=e.data.clientHeight-110<553?e.data.clientHeight-110:553;e.data.y_coordinate+n>e.data.clientHeight?(console.log("posleft"),t.style.borderTop="10px solid transparent",t.style.borderBottom="10px solid transparent",t.style.borderLeft="10px solid green",t.style.top="10px",t.style.right="0px"):e.data.clientHeight-e.data.y_coordinate>n?console.log("sasa"):e.data.clientHeight-e.data.y_coordinate>e.data.y_coordinate?(console.log("posbottom"),t.style.borderLeft="10px solid transparent",t.style.borderRight="10px solid transparent",t.style.borderTop="10px solid green",t.style.top=n+10+"px",t.style.right="185px"):(console.log("postop"),t.style.borderLeft="10px solid transparent",t.style.borderRight="10px solid transparent",t.style.borderBottom="10px solid green")},e.prototype.initAgentWidget=function(){var e=this;this.fuguWidgetService.fuguWidgetData.access_token&&this.fuguWidgetService.agentLoginViaAuthToken().takeWhile(function(){return e.alive}).subscribe(function(t){e.commonService.postMessageToParentWindow({type:"AccessTokenEvent",data:t.data.access_token}),e.setupFayeAndGetUnreadCount(t),e.fuguWidgetService.fuguWidgetData.dashboard_url&&e.getWhitelabelDetails()})},e.prototype.initForkedAgentWidget=function(){var e=this;this.fuguWidgetService.fuguWidgetData.agent_secret_key&&this.fuguWidgetService.agentLoginViaSecretKey().takeWhile(function(){return e.alive}).subscribe(function(t){e.setupFayeAndGetUnreadCount(t),e.commonService.postMessageToParentWindow({type:"AccessTokenEvent",data:t.data.access_token}),e.fuguWidgetService.fuguWidgetData.dashboard_url&&e.getWhitelabelDetails()})},e.prototype.setupFayeAndGetUnreadCount=function(e){var t=this,n=e.data.access_token;this.fuguWidgetService.fuguWidgetData.access_token=n,this.fuguWidgetService.fuguWidgetData.appSecretKey=e.data.app_secret_key,this.commonService.userDetails.access_token=n,this.commonService.userDetails.en_user_id=e.data.en_user_id,this.fuguWidgetService.getConfigurations(n).takeWhile(function(){return t.alive}).subscribe(function(e){t.fuguWidgetService.configFetchEvent.emit(e)},function(e){console.log("get config error: ",e.json())}),this.commonService.updateUserDetails(e.data),this.fayeService.setupSubscriptions(),this.fuguWidgetService.getUnreadCount(this.fuguWidgetService.fuguWidgetData.user_unique_keys).subscribe(function(e){var n=e.data.agent_customer_unread_count,i=e.data.total_unread_count;Object.keys(i).length&&Object.keys(i).map(function(e){t.commonService.channelwiseUnreadCount[e]={},t.commonService.channelwiseUnreadCount[e].customersInvolved=[],t.commonService.channelwiseUnreadCount[e].unreadCount=i[e],t.commonService.totalUnreadCount+=i[e]}),Object.keys(n).length&&Object.keys(n).map(function(e){var i=0;Object.keys(n[e]).map(function(a){i+=n[e][a],-1==t.commonService.channelwiseUnreadCount[a].customersInvolved.indexOf(e)&&t.commonService.channelwiseUnreadCount[a].customersInvolved.push(e)}),t.commonService.customerwiseUnreadCount[e]=i}),t.commonService.postMessageToParentWindow({type:"UnreadCount",data:t.commonService.customerwiseUnreadCount}),t.commonService.postMessageToParentWindow({type:"TotalUnreadCount",data:t.commonService.totalUnreadCount})})},e.prototype.openCustomerConversation=function(){this.fuguWidgetService.fuguWidgetData.access_token&&this.commonService.customerChatClicked.emit()},e.prototype.ngOnDestroy=function(){this.alive=!1},e.prototype.getWhitelabelDetails=function(){var e=this,t=this.fuguWidgetService.fuguWidgetData.dashboard_url;this.fuguWidgetService.getWhitelabelInfo(t).subscribe(function(t){e.commonService.redirectionTooltipText=t.data.whitelabeled_tab_title},function(e){})},e.ctorParameters=function(){return[{type:d.k},{type:l.a},{type:g.a},{type:h.a}]},e}(),m=[["#arrow[_ngcontent-%COMP%]{width:0;height:0;position:absolute}"]],v=a._14({encapsulation:0,styles:m,data:{}});function y(e){return a._40(0,[(e()(),a._38(-1,null,["\n"])),(e()(),a._17(1,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),a._15(2,212992,null,0,d.m,[d.b,a.Z,a.k,[8,null],a.i],null,null),(e()(),a._38(-1,null,["\n"]))],function(e,t){e(t,2,0)},null)}var b=a._12("app-root",_,function(e){return a._40(0,[(e()(),a._17(0,0,null,null,1,"app-root",[],null,[["window","message"]],function(e,t,n){var i=!0;return"window:message"===t&&(i=!1!==a._30(e,1).onWindowOffline(n)&&i),i},y,v)),a._15(1,245760,null,0,_,[d.k,l.a,g.a,h.a],null,null)],function(e,t){e(t,1,0)},null)},{},{},[]),S=n("2Je8"),C=n("1GJ2"),w=n("KN8t"),W=n("NVOs"),k=n("Fzro"),D=n("Um43"),O=n("PP02"),I=n("2CBl"),T=n("NG/o"),P=a._13(c,[_],function(e){return a._28([a._29(512,a.k,a._9,[[8,[b]],[3,a.k],a.E]),a._29(5120,a.A,a._27,[[3,a.A]]),a._29(4608,S.m,S.l,[a.A]),a._29(5120,a.c,a._18,[]),a._29(5120,a.y,a._24,[]),a._29(5120,a.z,a._25,[]),a._29(4608,s.c,s.t,[S.c]),a._29(6144,a.Q,null,[s.c]),a._29(4608,s.f,u,[]),a._29(5120,s.d,function(e,t,n,i){return[new s.l(e),new s.p(t),new s.o(n,i)]},[S.c,S.c,S.c,s.f]),a._29(4608,s.e,s.e,[s.d,a.G]),a._29(135680,s.n,s.n,[S.c]),a._29(4608,s.m,s.m,[s.e,s.n]),a._29(5120,C.a,w.d,[]),a._29(5120,C.c,w.e,[]),a._29(4608,C.b,w.c,[C.a,C.c]),a._29(5120,a.O,w.f,[s.m,C.b,a.G]),a._29(6144,s.q,null,[s.n]),a._29(4608,a.X,a.X,[a.G]),a._29(4608,s.h,s.h,[S.c]),a._29(4608,s.j,s.j,[S.c]),a._29(4608,W.z,W.z,[]),a._29(4608,W.f,W.f,[]),a._29(4608,k.c,k.c,[]),a._29(4608,k.h,k.b,[]),a._29(5120,k.j,k.k,[]),a._29(4608,k.i,k.i,[k.c,k.h,k.j]),a._29(4608,k.g,k.a,[]),a._29(5120,k.e,k.l,[k.i,k.g]),a._29(4608,D.b,w.b,[a.O,s.b]),a._29(5120,d.a,d.u,[d.k]),a._29(4608,d.d,d.d,[]),a._29(6144,d.f,null,[d.d]),a._29(135680,d.n,d.n,[d.k,a.D,a.j,a.w,d.f]),a._29(4608,d.e,d.e,[]),a._29(5120,d.h,d.x,[d.v]),a._29(5120,a.b,function(e){return[e]},[d.h]),a._29(4608,g.a,g.a,[k.e]),a._29(135680,l.a,l.a,[g.a]),a._29(4608,O.a,O.a,[]),a._29(135680,h.a,h.a,[l.a,g.a]),a._29(135680,I.a,I.a,[h.a,l.a,g.a]),a._29(512,S.b,S.b,[]),a._29(1024,a.o,s.r,[]),a._29(1024,a.F,function(){return[d.r()]},[]),a._29(512,d.v,d.v,[a.w]),a._29(1024,a.d,function(e,t,n){return[s.s(e,t),d.w(n)]},[[2,s.i],[2,a.F],d.v]),a._29(512,a.e,a.e,[[2,a.d]]),a._29(131584,a._16,a._16,[a.G,a._10,a.w,a.o,a.k,a.e]),a._29(2048,a.g,null,[a._16]),a._29(512,a.f,a.f,[a.g]),a._29(512,s.a,s.a,[[3,s.a]]),a._29(512,W.w,W.w,[]),a._29(512,W.l,W.l,[]),a._29(512,W.t,W.t,[]),a._29(512,k.f,k.f,[]),a._29(1024,d.q,d.s,[[3,d.k]]),a._29(512,d.p,d.c,[]),a._29(512,d.b,d.b,[]),a._29(512,S.h,S.e,[S.p,[2,S.a]]),a._29(512,S.g,S.g,[S.h]),a._29(512,a.j,a.j,[]),a._29(512,a.D,a.U,[a.j,[2,a.V]]),a._29(1024,d.i,function(){return[[{path:"payment",loadChildren:"./modules/payment-request/payment-request.module#PaymentRequestModule"},{path:"",loadChildren:"./modules/layout/layout.module#LayoutModule"}]]},[]),a._29(256,d.g,{},[]),a._29(1024,d.k,d.t,[a.g,d.p,d.b,S.g,a.w,a.D,a.j,d.i,d.g,[2,d.o],[2,d.j]]),a._29(512,d.l,d.l,[[2,d.q],[2,d.k]]),a._29(512,w.a,w.a,[]),a._29(512,T.a,T.a,[]),a._29(512,c,c,[])])});o.a.production&&Object(a._3)();var N=n("DtRx");localStorage.getItem("device_uuid")||localStorage.setItem("device_uuid",N()),Object(s.k)().bootstrapModuleFactory(P)},zCXK:function(e,t,n){"use strict";var i,a,o,s,r,u,c;n.d(t,"d",function(){return i}),n.d(t,"g",function(){return a}),n.d(t,"e",function(){return o}),n.d(t,"f",function(){return s}),n.d(t,"c",function(){return r}),n.d(t,"a",function(){return u}),n.d(t,"b",function(){return c}),function(e){e[e.Customer_Agent_Message=1]="Customer_Agent_Message",e[e.Activity_Message=2]="Activity_Message",e[e.Private_Message=3]="Private_Message",e[e.Image_Message=10]="Image_Message",e[e.File_Message=11]="File_Message",e[e.Bot_Text_Message=15]="Bot_Text_Message",e[e.Form_Message=17]="Form_Message",e[e.Button_Message=16]="Button_Message",e[e.Feedback_Message=14]="Feedback_Message",e[e.Video_Call=18]="Video_Call",e[e.Payment_Message=19]="Payment_Message",e[e.Custom_Action_Message=20]="Custom_Action_Message"}(i||(i={})),function(e){e[e.Bot=0]="Bot",e[e.Customer=2]="Customer",e[e.Agent=1]="Agent"}(a||(a={})),function(e){e[e.Chat_Reassign=3]="Chat_Reassign",e[e.Read_Unread=5]="Read_Unread",e[e.Read_All=6]="Read_All",e[e.User_Migration=7]="User_Migration",e[e.User_Logout=8]="User_Logout",e[e.User_Online_Status=15]="User_Online_Status",e[e.INRIDE_STATUS=16]="INRIDE_STATUS",e[e.CHANNEL_REFRESH_AGENT=17]="CHANNEL_REFRESH_AGENT",e[e.Channel_Refresh=13]="Channel_Refresh"}(o||(o={})),function(e){e[e.Typing_End=0]="Typing_End",e[e.Typing_Start=1]="Typing_Start",e[e.Typing_Stopped=2]="Typing_Stopped"}(s||(s={})),function(e){e[e.Sending=0]="Sending",e[e.Sent=1]="Sent",e[e.Delivered=2]="Delivered",e[e.Read=3]="Read"}(r||(r={})),function(e){e[e.p2p=1]="p2p",e[e.other=0]="other",e[e.AdminToAdmin=2]="AdminToAdmin"}(u||(u={})),function(e){e[e.EMAIL=5]="EMAIL",e[e.MESSENGER=6]="MESSENGER",e[e.WHATSAPP=7]="WHATSAPP"}(c||(c={}))}},[0]);